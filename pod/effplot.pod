=head1 Description

The EFFPLOT macro produces an 'effect display,'  a plot of predicted
values for one term in a linear or generalized linear mode.  In this
plot, all lower-order terms marginal to a given effect are absorbed,
and other terms in the model are averaged over. These plots are particularly
useful for visualizing interactions in complex models.

At present, these plots are provided for PROC REG, PROC GLM, PROC
LOGISTIC and PROC GENMOD.

=head2 Method

The essential idea is to calculate predicted values from the model over
a grid of values of all predictors and then plot the average of these
over variables not included in the given term.  To do this, the set of
predictor values specified by the C<GRID=> parameter is appended to the
input data set. Predicted values (and appropriate standard errors) are 
then generated by the fitting procedure. This is similar to the use of
the SCORE statement in PROC LOGISTIC, but with more functionality.

In this version, using the MEANPLOT macro to do the plotting,  the 
parameters C<XVAR=>, C<CVAR=> and C<PVAR=> determine the  variables displayed 
in a 1-way to 3-way effect.  All other predictors are effectively
averaged over.

As well, the macro calculates appropriate point-wise standard errors 
and upper/lower 1-ALPHA intervals for  each grid point.  These are
returned in the C<OUT=> data set, but this version does not plot them. 

=head1 Usage

The EFFPLOT macro is defined with keyword parameters.
The arguments may be listed within parentheses in any order, separated
by commas. For example: 

  %effplot(data=myexp, y=Response, model=X1 X2,
     grid=%str(X1=0 to 10, X2=5 10 15),
     xvar=X1, cvar=X2);

=head2 Parameters

=over 4

=item DATA=

The name of the input data set

=item Y=

Name of response variable in the input dataset

=item RESPONSE=

Synonym for C<Y=>

=item CLASS=

Class (factor) variables

=item MODEL=

Right-hand side of MODEL statement

=item XVAR=

Horizontal value for plot [NUMERIC|CHAR]

=item CVAR=

Variable for curves within each plot, for a 2-way or 3-way effect

=item PVAR=

Variable defining the panels of multiple plots, for a 3-way effect

=item PROC=

Procedure to run: GLM, REG, LOGISTIC or GENMOD [Default: C<PROC=REG>]

=item PROCOPTS=

Extra options on PROC statement

=item MODOPTS=

Extra options on the MODEL statement

=item GRID=

Grid of predictor values for plot or grid data set.  This should
be a specification in the form of a comma-separated list of
VAR=VALUes, as accepted by the EXPGRID macro.  

All predictors in the model must be assigned a value so that
a predicted value can be calculated for all observations in the
grid data set.

For a numeric variable that is to be averaged over in the plot, 
you can specify a single number, representing the value at which 
other effects are averaged. For example, with sex (0/1) as a
predictor with 67% males (1), include 'sex=0.67' to represent
sex at the average level in the sample, or 'sex=0.5' for
the average level in an equal population of males and females.

=item ALPHA=

Alpha for lower/upper limits [Default: C<ALPHA=0.33>]

=item YLAB=

Label for fitted response variable [Default: C<YLAB=&Y>]

=item HAXIS=

Axis statement for horizontal axis

=item VAXIS=

Axis statement for response axis

=item LEGEND=

Legend statement for custom CVAR legend

=item SYMBOLS=

List of SAS/GRAPH symbols for the levels of the CVAR=variable.  
There should be as many symbols as there are distinct values of 
the CVAR=variable. 
[Default: C<SYMBOLS=%STR(CIRCLE SQUARE $ : TRIANGLE = X _ Y)>]

=item COLORS=

List of SAS/GRAPH colors for the levels of the CVAR=variable.
 There should be as many colors as there are distinct values 
of the CVAR=variable. 
[Default: C<COLORS=BLACK RED BLUE GREEN BROWN ORANGE PURPLE YELLOW>]

=item LINES=

List of SAS/GRAPH line styles for the levels of the CVAR=variable.
 There should be as many lines as there are distinct values of 
the CVAR=variable. 
[Default: C<LINES=1 20 41 21 7 14 33 12>]

=item ANNO=

Additional input annotate data set

=item PRINT=

Print the C<OUT=> data set?

=item OUT=

The name of the output data set [Default: C<OUT=EFFECTS>]

=item GOUT=

The name of the graphics catalog [Default: C<GOUT=WORK.GSEG>]

=item NAME=

The name of the graph in the graphic catalog [Default: C<NAME=EFFPLOT>]


=back 4

=head1 Examples

  *-- arrests1.sas; 
  %include data(arrests);
  axis1 order=(0.5 to 0.8 by 0.1) label=(a=90);
  title 'Toronto Star arrests data: Colour * Age effect';
  %effplot(data=arrests,
     y=released,
     class=colour employed citizen,
     model=employed citizen checks colour|year colour|age,
     grid=%str(employed=0 1, citizen=0 1, checks=0 to 6, colour=Black White, age=15 to 45 by 5, year=1997 to 2002),
     cvar=colour,
     xvar=age,
     vaxis=axis1,
     ylab=Prob(Released),
     proc=logistic, procopts=descending);


